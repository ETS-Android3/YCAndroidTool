#### 目录总结
- 01.什么是卡顿现象
- 02.UI卡顿产生的原因
- 03.卡顿和ANR的关系
- 04.FPS流畅度测试
- 05.治理卡顿的流程




### 01.什么是卡顿现象
- UI线程执行时间
    - 在Android中，UI线程负责执行UI视图的布局、渲染等工作，UI在更新期间，如果UI线程执行时间超过了16ms，则就会产生丢帧的现象，大量的丢帧，就会造成卡顿，影响用户体验。
    - Android中规定，每秒可以执行60次屏幕刷新，当我们的APP能够达到60帧/秒时，这种体验是优秀的，当帧率降低到40帧以下，甚至30帧以下，用户就可以感知到卡顿了。
- 时间计算公式
    - 公式（1秒刷新60次，那么每次刷新耗时16毫秒）：1000毫秒 / 60帧  = 16ms ， 关于帧率怎么查看呢？可以通过fps查看
- 卡顿优化点分析
    - 如果没能在16ms内完成这个过程，就会使屏幕重复显示上一帧的内容，即造成了卡顿。在这16ms内，需要完成视图树的所有测量、布局、绘制渲染及合成。而我们的优化工作主要就是针对这个过程的。


### 02.UI卡顿产生的原因
- UI卡顿通常产生的原因如下：
    - 系统CPU资源紧张，分配给APP主线程（UI线程）的CPU时间片减少。
    - UI线程中执行了大量的耗时任务，导致了UI线程视图刷新工作的阻塞。
    - Android虚拟机频繁执行GC操作导致的卡顿。由于GC会占用大量的系统资源，同时GC过程中会产生UI线程停顿，从而产生卡顿。
    - 过度绘制产生卡顿。过度绘制会导致GPU执行时间变长，从而产生丢帧现象。


### 03.卡顿和ANR的关系
- 卡顿与ANR的关系
    - 产生卡顿的根本原因是UI线程不能够及时的进行渲染，导致UI的反馈不能按照用户的预期，连续、一致的呈现。
    - 产生卡顿的原因多种多样，很难一一列举，而ANR是Google人为规定的概念，产生ANR的原因最多也只有四个。
- 两者相关但不同纬度
    - 事实上，长时间的UI卡顿是导致ANR最常见的原因；但另一方面，从原理上来看，两者既不充分也不必要，是两个维度的概念。
- 卡顿监控ANR准确吗
    - 一些卡顿监控工具，经常被拿来监控ANR（卡顿阈值设置为5秒），这其实很不严谨：首先，5秒只是发生ANR的其中一种原因（Touch事件5秒未被及时消费）的阈值，而其他原因发生ANR的阈值并不是5秒；另外，就算是主线程卡顿了5秒，如果用户没有输入任何的Touch事件，同样是不会发生ANR的，更何况还有后台ANR等情况。



### 04.FPS流畅度测试
- 流畅度，是页面在滑动、渲染等过程中的体验。
    - Android系统要求每一帧都要在 16ms 内绘制完成，平滑的完成一帧意味着任何特殊的帧需要执行所有的渲染代码（包括 framework 发送给 GPU 和 CPU 绘制到缓冲区的命令）都要在 16ms 内完成，保持流畅的体验。
    - 如果没有在期间完成渲染秒就会发生掉帧。掉帧是用户体验中一个非常核心的问题。丢弃了当前帧，并且之后不能够延续之前的帧率，这种不连续的间隔会容易会引起用户的注意，也就是我们常说的卡顿、不流畅。
- 如何查看FPS流畅度
    - 待完善，todo


### 05.治理卡顿的流程
- 优化卡顿的步骤
    - 监控卡顿的发生 ---> 准确定位到哪个模块(甚至哪个方法导致了卡) ---> 分析代码并解决卡顿
- 监控卡顿的发生
    - 主要使用工具监控
- 定位到卡顿的点
    - 待完善
- 分析代码并解决卡顿
    - UI卡顿
    - 线程卡顿
    - 过渡绘制卡顿






