







```
/**
 * 设置动画，仿淘宝添加到购物车动画，这里是一个点到另一个点的动画效果，思考，如何设置抛物线运动？？？？
 * @param top                               点击item的view
 * @param bottom                            pk的底部view
 */
public void startAnim(View top , View bottom) {
    if (top==null || bottom==null){
        return;
    }
    // 记录开始的位置
    // 一个整型数组，用来存储按钮的在屏幕的X、Y坐标
    int[] startLocation = new int[2];
    // 这是获取item上pk控件的在屏幕的X、Y坐标（这也是动画开始的坐标）
    top.getLocationInWindow(startLocation);
    // 创建要做动画的ImageView
    // 动画的view
    ImageView animImageView = new ImageView(this);
    // 设置animImageView的背景
    Drawable background = this.getResources().getDrawable(R.drawable.yilu_price_pk_red);
    Drawable zoomDrawable = AppUtils.zoomDrawable(background, SizeUtils.dp2px(200), SizeUtils.dp2px(200));
    animImageView.setBackgroundDrawable(zoomDrawable);
    // 开始执行动画
    try {
        setAnim(animImageView, startLocation, bottom);
    } catch (Exception e){
        e.printStackTrace();
    }
}

/**
 * 设置动画
 */
private void setAnim(final View v, int[] startLocation, final View bottom) {
    //创建动画层
    ViewGroup animMaskLayout = createAnimLayout();
    if (animMaskLayout ==null){
        return;
    }
    // 把动画小球添加到动画层
    animMaskLayout.addView(v);
    final View viewa = addViewToAnimLayout(v, startLocation);
    // 存储动画结束位置的X、Y坐标
    int[] endLocation = new int[2];
    // pk
    bottom.getLocationInWindow(endLocation);
    // 计算位移
    // 动画位移的X坐标
    int endX = endLocation[0] - startLocation[0];
    // 动画位移的y坐标
    int endY = endLocation[1] - startLocation[1];
    TranslateAnimation translateAnimationX = new TranslateAnimation(0, endX+50, 0, 0);
    translateAnimationX.setInterpolator(new LinearInterpolator());
    translateAnimationX.setRepeatCount(0);
    translateAnimationX.setFillAfter(true);
    TranslateAnimation translateAnimationY = new TranslateAnimation(0, 0, 0, endY+50);
    translateAnimationY.setInterpolator(new AccelerateInterpolator());
    translateAnimationY.setRepeatCount(0);
    translateAnimationX.setFillAfter(true);
    ScaleAnimation scaleAnimation = new ScaleAnimation(0.6f, 0.1f,0.6f, 0.1f);
    scaleAnimation.setInterpolator(new AccelerateInterpolator());
    scaleAnimation.setRepeatCount(0);
    scaleAnimation.setFillAfter(true);
    AnimationSet set = new AnimationSet(false);
    set.setFillAfter(false);
    //缩放动画
    set.addAnimation(scaleAnimation);
    //y评议动画
    set.addAnimation(translateAnimationY);
    //x评议动画
    set.addAnimation(translateAnimationX);
    // 动画的执行时间
    set.setDuration(800);
    viewa.startAnimation(set);
    // 动画监听事件
    set.setAnimationListener(new Animation.AnimationListener() {
        // 动画的开始
        @Override
        public void onAnimationStart(Animation animation) {
            v.setVisibility(View.VISIBLE);
        }

        @Override
        public void onAnimationRepeat(Animation animation) {
        }

        // 动画的结束
        @Override
        public void onAnimationEnd(Animation animation) {
            v.setVisibility(View.GONE);
        }
    });
}

/**
 * 创建动画层
 * @return
 */
private ViewGroup createAnimLayout() {
    if (this.getWindow()!=null){
        // 获取跟布局
        ViewGroup rootView = (ViewGroup) this.getWindow().getDecorView();
        LinearLayout animLayout = new LinearLayout(this);
        LinearLayout.LayoutParams lp = new LinearLayout.LayoutParams(
                LinearLayout.LayoutParams.MATCH_PARENT, LinearLayout.LayoutParams.MATCH_PARENT);
        animLayout.setLayoutParams(lp);
        animLayout.setId(Integer.MAX_VALUE);
        animLayout.setBackgroundResource(android.R.color.transparent);
        rootView.addView(animLayout);
        return animLayout;
    }
    return null;
}

private View addViewToAnimLayout(final View view, int[] location) {
    int x = location[0];
    int y = location[1];
    LinearLayout.LayoutParams lp = new LinearLayout.LayoutParams(
            LinearLayout.LayoutParams.WRAP_CONTENT, LinearLayout.LayoutParams.WRAP_CONTENT);
    lp.leftMargin = x;
    lp.topMargin = y;
    view.setLayoutParams(lp);
    return view;
}
```


















